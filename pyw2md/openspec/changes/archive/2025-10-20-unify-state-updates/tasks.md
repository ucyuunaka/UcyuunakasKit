# 统一多组件状态更新机制 - 任务清单

## 第一阶段：移除冗余状态更新调用

### 任务 1.1: 清理app.py中的冗余调用
- [ ] 移除第464行的`self.control_panel.update_stats()`调用
- [ ] 移除第757行的`self.control_panel.update_stats()`调用
- [ ] 验证移除后状态栏统计仍正常更新
- [ ] 运行功能测试确保无回归

### 任务 1.2: 清理其他文件中的冗余调用
- [ ] 搜索整个代码库，查找所有`update_stats()`调用
- [ ] 移除所有废弃的调用
- [ ] 更新相关文档和注释

### 任务 1.3: 移除control_panel中的废弃方法
- [ ] 从`ui/components/control_panel.py`中移除`update_stats()`方法（第198行）
- [ ] 清理方法相关的导入和依赖
- [ ] 更新类文档字符串

## 第二阶段：统一防抖机制

### 任务 2.1: 统一文件列表面板防抖时间
- [ ] 修改`file_list_panel.py`第472行，将500ms防抖改为300ms
- [ ] 更新相关注释说明统一标准
- [ ] 测试搜索和筛选功能的响应性

### 任务 2.2: 统一主应用防抖时间
- [ ] 修改`app.py`中所有防抖调用，统一为300ms
- [ ] 创建常量`UI_UPDATE_DEBOUNCE = 300`供全局使用
- [ ] 更新相关方法文档

### 任务 2.3: 验证防抖效果
- [ ] 测试快速连续操作的处理
- [ ] 验证UI响应性能
- [ ] 确保无操作丢失

## 第三阶段：优化统计逻辑

### 任务 3.1: 强化StatusBar的统计中心角色
- [ ] 在`status_bar.py`中添加统计更新接口
- [ ] 实现批量更新优化
- [ ] 添加统计缓存机制

### 任务 3.2: 创建统一的状态更新辅助方法
- [ ] 在`app.py`中创建`_sync_ui_state()`方法
- [ ] 整合文件列表、状态栏的更新调用
- [ ] 添加错误处理和状态保护

### 任务 3.3: 优化状态更新时序
- [ ] 实现事务性状态更新
- [ ] 添加状态一致性检查
- [ ] 创建状态更新日志（调试模式）

## 第四阶段：测试和验证

### 任务 4.1: 编写单元测试
- [ ] 为状态更新逻辑编写测试用例
- [ ] 测试防抖机制的正确性
- [ ] 验证统计信息的准确性

### 任务 4.2: 集成测试
- [ ] 测试文件添加/删除的状态同步
- [ ] 测试转换完成后的状态更新
- [ ] 测试错误情况下的状态处理

### 任务 4.3: 性能测试
- [ ] 测试大量文件时的更新性能
- [ ] 验证内存使用情况
- [ ] 检查是否有内存泄漏

## 第五阶段：文档和发布

### 任务 5.1: 更新技术文档
- [ ] 更新相关组件的文档字符串
- [ ] 添加状态更新流程图
- [ ] 更新开发者指南

### 任务 5.2: 用户文档更新
- [ ] 如有UI变化，更新用户手册
- [ ] 记录性能改进
- [ ] 准备发布说明

## 依赖关系

```
1.1 -> 1.2 -> 1.3
   \-> 2.1 -> 2.2 -> 2.3
      \-> 3.1 -> 3.2 -> 3.3
         \-> 4.1 -> 4.2 -> 4.3
            \-> 5.1 -> 5.2
```

## 风险缓解

- **功能回归风险**：每个阶段都进行充分测试
- **性能影响风险**：保留性能基准测试结果
- **用户体验风险**：保持UI行为一致性
- **代码冲突风险**：小步提交，频繁集成

## 完成标准

- [ ] 所有冗余`update_stats()`调用已移除
- [ ] 所有防抖时间统一为300ms
- [ ] 统计信息只通过StatusBar更新
- [ ] 所有测试通过
- [ ] 代码审查通过
- [ ] 文档已更新