# 重构刷新和自动检测系统

## Why

pyw2md项目的文件刷新和自动检测功能存在严重的架构设计问题，导致状态管理混乱、用户体验不一致和维护困难。具体表现为：

1. **状态分散管理**：文件变化状态分散在4个不同组件中，导致数据不一致和同步困难
2. **防抖机制混乱**：三套不同的防抖时间（1秒、300ms、3秒）造成不可预测的用户体验
3. **过度设计**：复杂的UI通知系统与简单的信息显示需求不匹配
4. **错误处理不足**：用户无法感知功能是否正常工作

通过重构建立统一、简洁、可靠的文件刷新架构。

## What Changes

- **统一状态管理**：创建单一的FileState类管理所有文件变化状态
- **简化通知系统**：移除复杂的UI通知栏，使用简单的状态栏消息
- **统一防抖机制**：实现单一的防抖逻辑，消除重复实现
- **增强错误处理**：提供用户可见的错误反馈和功能降级
- **优化组件交互**：减少组件间的直接依赖，提升可维护性

## Impact

- **Affected specs**: `ui-state-management`, `component-interaction`
- **Affected code**:
  - `core/file_watcher.py` - 统一防抖时间和错误处理
  - `ui/app.py` - 移除复杂通知系统，使用统一状态管理
  - `ui/components/status_bar.py` - 简化消息显示机制
  - `ui/components/file_list_panel.py` - 统一状态更新接口

## 实施策略

采用渐进式重构，确保功能稳定：

1. **第一阶段**：创建新的统一状态管理类
2. **第二阶段**：简化通知系统，移除复杂UI
3. **第三阶段**：统一防抖机制和错误处理
4. **第四阶段**：优化组件交互和接口

## 验收标准

- 所有文件变化状态通过单一类管理
- 移除复杂的通知栏UI组件
- 统一防抖时间为300ms
- 提供用户可见的错误反馈
- 功能测试通过，无回归问题
- 代码复杂度降低50%以上