# Code2Markdown - Material Design é‡æ„ç‰ˆ

æˆ‘ä¸ºä½ é‡æ„äº†æ•´ä¸ªåº”ç”¨ï¼Œé‡‡ç”¨ **Material Design 3** è®¾è®¡ç†å¿µï¼Œå¹¶è¿›è¡Œäº†å®Œæ•´çš„æ¨¡å—åŒ–æ‹†åˆ†ã€‚

## ğŸ“ æ–°çš„é¡¹ç›®ç»“æ„

```
code2markdown/
â”œâ”€â”€ main.py                      # åº”ç”¨å…¥å£
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ settings.py              # é…ç½®ç®¡ç†
â”‚   â””â”€â”€ theme.py                 # Material Design ä¸»é¢˜
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ file_handler.py          # æ–‡ä»¶å¤„ç†æ ¸å¿ƒ
â”‚   â””â”€â”€ converter.py             # è½¬æ¢é€»è¾‘
â”œâ”€â”€ ui/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ app.py                   # ä¸»åº”ç”¨çª—å£
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ file_list_panel.py   # æ–‡ä»¶åˆ—è¡¨é¢æ¿
â”‚   â”‚   â”œâ”€â”€ control_panel.py     # æ§åˆ¶é¢æ¿
â”‚   â”‚   â””â”€â”€ dialogs.py           # å„ç§å¯¹è¯æ¡†
â”‚   â””â”€â”€ widgets/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â””â”€â”€ material_card.py     # Material å¡ç‰‡ç»„ä»¶
â””â”€â”€ utils/
    â”œâ”€â”€ __init__.py
    â””â”€â”€ helpers.py               # è¾…åŠ©å‡½æ•°
```

## ğŸ’¾ å®Œæ•´ä»£ç 

### 1. `main.py` - åº”ç”¨å…¥å£

```python
"""
Code2Markdown - Material Design 3
ç°ä»£åŒ–ä»£ç è½¬Markdownå·¥å…·
"""

import customtkinter as ctk
from ui.app import MaterialApp

def main():
    """åº”ç”¨å…¥å£"""
    ctk.set_appearance_mode("dark")
    ctk.set_default_color_theme("blue")
    
    app = MaterialApp()
    app.mainloop()

if __name__ == "__main__":
    main()
```

### 2. `config/theme.py` - Material Design ä¸»é¢˜

```python
"""
Material Design 3 ä¸»é¢˜é…ç½®
åŸºäº Material You è®¾è®¡ç³»ç»Ÿ
"""

class MaterialTheme:
    """Material Design 3 é¢œè‰²ç³»ç»Ÿ"""
    
    # ä¸»è‰²è°ƒ - ç´«è“è‰²ç³»
    PRIMARY = "#6750A4"
    PRIMARY_CONTAINER = "#EADDFF"
    ON_PRIMARY = "#FFFFFF"
    ON_PRIMARY_CONTAINER = "#21005E"
    
    # æ¬¡è¦è‰² - ç²‰ç´«è‰²ç³»
    SECONDARY = "#625B71"
    SECONDARY_CONTAINER = "#E8DEF8"
    ON_SECONDARY = "#FFFFFF"
    ON_SECONDARY_CONTAINER = "#1E192B"
    
    # ç¬¬ä¸‰è‰² - æš–çº¢è‰²ç³»
    TERTIARY = "#7D5260"
    TERTIARY_CONTAINER = "#FFD8E4"
    ON_TERTIARY = "#FFFFFF"
    ON_TERTIARY_CONTAINER = "#370B1E"
    
    # é”™è¯¯è‰²
    ERROR = "#BA1A1A"
    ERROR_CONTAINER = "#FFDAD6"
    ON_ERROR = "#FFFFFF"
    ON_ERROR_CONTAINER = "#410002"
    
    # èƒŒæ™¯è‰² - æ·±è‰²ä¸»é¢˜
    BACKGROUND = "#1C1B1F"
    ON_BACKGROUND = "#E6E1E5"
    
    # è¡¨é¢è‰²
    SURFACE = "#1C1B1F"
    SURFACE_1 = "#2B2930"  # é«˜ç¨‹1
    SURFACE_2 = "#322F37"  # é«˜ç¨‹2
    SURFACE_3 = "#38353E"  # é«˜ç¨‹3
    SURFACE_4 = "#3A3740"  # é«˜ç¨‹4
    SURFACE_5 = "#403D46"  # é«˜ç¨‹5
    
    ON_SURFACE = "#E6E1E5"
    ON_SURFACE_VARIANT = "#CAC4D0"
    
    # è½®å»“è‰²
    OUTLINE = "#938F99"
    OUTLINE_VARIANT = "#49454F"
    
    # æˆåŠŸè‰²ï¼ˆæ‰©å±•ï¼‰
    SUCCESS = "#4CAF50"
    SUCCESS_CONTAINER = "#C8E6C9"
    
    # è­¦å‘Šè‰²ï¼ˆæ‰©å±•ï¼‰
    WARNING = "#FF9800"
    WARNING_CONTAINER = "#FFE0B2"
    
    # ä¿¡æ¯è‰²ï¼ˆæ‰©å±•ï¼‰
    INFO = "#2196F3"
    INFO_CONTAINER = "#BBDEFB"
    
    # å­—ä½“
    FONT_FAMILY = "Segoe UI Variable"
    FONT_DISPLAY = (FONT_FAMILY, 28, "bold")
    FONT_HEADLINE = (FONT_FAMILY, 24, "bold")
    FONT_TITLE = (FONT_FAMILY, 16, "bold")
    FONT_BODY_LARGE = (FONT_FAMILY, 14)
    FONT_BODY = (FONT_FAMILY, 12)
    FONT_LABEL = (FONT_FAMILY, 11)
    FONT_MONO = ("Consolas", 11)
    
    # åœ†è§’
    RADIUS_SMALL = 8
    RADIUS_MEDIUM = 12
    RADIUS_LARGE = 16
    RADIUS_XLARGE = 28
    
    # é—´è·
    SPACING_XS = 4
    SPACING_SM = 8
    SPACING_MD = 16
    SPACING_LG = 24
    SPACING_XL = 32
    
    # é˜´å½±ï¼ˆæ¨¡æ‹Ÿï¼‰
    SHADOW_COLOR = "#00000040"

# å¿«æ·è®¿é—®
MD = MaterialTheme
```

### 3. `config/settings.py` - é…ç½®ç®¡ç†

```python
"""
åº”ç”¨é…ç½®ç®¡ç†
"""

import json
import os
from typing import Dict, Any

class Settings:
    """é…ç½®ç®¡ç†å™¨"""
    
    def __init__(self, config_file: str = "config.json"):
        self.config_file = config_file
        self.config: Dict[str, Any] = {}
        self.load()
    
    def load(self):
        """åŠ è½½é…ç½®"""
        if not os.path.exists(self.config_file):
            self.config = self._default_config()
            self.save()
            return
        
        try:
            with open(self.config_file, 'r', encoding='utf-8') as f:
                self.config = json.load(f)
        except Exception as e:
            print(f"åŠ è½½é…ç½®å¤±è´¥: {e}")
            self.config = self._default_config()
    
    def save(self):
        """ä¿å­˜é…ç½®"""
        try:
            with open(self.config_file, 'w', encoding='utf-8') as f:
                json.dump(self.config, f, indent=2, ensure_ascii=False)
        except Exception as e:
            print(f"ä¿å­˜é…ç½®å¤±è´¥: {e}")
    
    def get(self, key: str, default=None):
        """è·å–é…ç½®é¡¹"""
        return self.config.get(key, default)
    
    def set(self, key: str, value: Any):
        """è®¾ç½®é…ç½®é¡¹"""
        self.config[key] = value
    
    def _default_config(self) -> Dict[str, Any]:
        """é»˜è®¤é…ç½®"""
        return {
            "window": {
                "width": 1280,
                "height": 800,
                "min_width": 1000,
                "min_height": 600
            },
            "template": "é»˜è®¤",
            "recent_files": [],
            "max_recent_files": 50,
            "auto_save_config": True,
            "preview_max_files": 5
        }
```

### 4. `core/file_handler.py` - æ–‡ä»¶å¤„ç†æ ¸å¿ƒ

```python
"""
æ–‡ä»¶å¤„ç†æ ¸å¿ƒæ¨¡å—
"""

import os
from typing import List, Dict, Optional
from dataclasses import dataclass

# æ”¯æŒçš„è¯­è¨€å’Œæ‰©å±•å
LANGUAGE_EXTENSIONS = {
    'Python': ['.py', '.pyw', '.pyi'],
    'JavaScript': ['.js', '.jsx', '.mjs'],
    'TypeScript': ['.ts', '.tsx'],
    'Java': ['.java'],
    'C': ['.c', '.h'],
    'C++': ['.cpp', '.hpp', '.cc', '.cxx'],
    'C#': ['.cs'],
    'PHP': ['.php'],
    'Ruby': ['.rb'],
    'Go': ['.go'],
    'Rust': ['.rs'],
    'Swift': ['.swift'],
    'Kotlin': ['.kt', '.kts'],
    'HTML': ['.html', '.htm'],
    'CSS': ['.css', '.scss', '.sass', '.less'],
    'SQL': ['.sql'],
    'Shell': ['.sh', '.bash', '.zsh'],
    'PowerShell': ['.ps1'],
    'YAML': ['.yml', '.yaml'],
    'JSON': ['.json'],
    'XML': ['.xml'],
    'Markdown': ['.md'],
    'Vue': ['.vue'],
    'Svelte': ['.svelte'],
    'Dart': ['.dart'],
    'R': ['.r', '.R'],
    'Lua': ['.lua'],
    'Perl': ['.pl', '.pm'],
    'Text': ['.txt']
}

@dataclass
class FileInfo:
    """æ–‡ä»¶ä¿¡æ¯æ•°æ®ç±»"""
    path: str
    marked: bool = True
    
    @property
    def name(self) -> str:
        return os.path.basename(self.path)
    
    @property
    def language(self) -> str:
        return get_language(self.path)
    
    @property
    def size(self) -> int:
        try:
            return os.path.getsize(self.path)
        except:
            return 0
    
    @property
    def exists(self) -> bool:
        return os.path.exists(self.path)

class FileHandler:
    """æ–‡ä»¶å¤„ç†å™¨"""
    
    def __init__(self):
        self.files: List[FileInfo] = []
    
    def add_file(self, path: str) -> bool:
        """æ·»åŠ å•ä¸ªæ–‡ä»¶"""
        if not os.path.isfile(path):
            return False
        
        # æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
        if any(f.path == path for f in self.files):
            return False
        
        self.files.append(FileInfo(path=path, marked=True))
        return True
    
    def add_files(self, paths: List[str]) -> int:
        """æ‰¹é‡æ·»åŠ æ–‡ä»¶"""
        count = 0
        for path in paths:
            if self.add_file(path):
                count += 1
        return count
    
    def add_folder(self, folder_path: str, recursive: bool = True) -> int:
        """æ·»åŠ æ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰æ”¯æŒæ–‡ä»¶"""
        if not os.path.isdir(folder_path):
            return 0
        
        files = scan_folder(folder_path, recursive)
        return self.add_files(files)
    
    def remove_file(self, path: str) -> bool:
        """ç§»é™¤æ–‡ä»¶"""
        for i, file in enumerate(self.files):
            if file.path == path:
                self.files.pop(i)
                return True
        return False
    
    def clear(self):
        """æ¸…ç©ºæ‰€æœ‰æ–‡ä»¶"""
        self.files.clear()
    
    def toggle_mark(self, path: str) -> bool:
        """åˆ‡æ¢æ–‡ä»¶æ ‡è®°çŠ¶æ€"""
        for file in self.files:
            if file.path == path:
                file.marked = not file.marked
                return file.marked
        return False
    
    def mark_all(self, marked: bool = True):
        """æ ‡è®°/å–æ¶ˆæ ‡è®°æ‰€æœ‰æ–‡ä»¶"""
        for file in self.files:
            file.marked = marked
    
    def get_marked_files(self) -> List[FileInfo]:
        """è·å–æ‰€æœ‰å·²æ ‡è®°çš„æ–‡ä»¶"""
        return [f for f in self.files if f.marked]
    
    def get_stats(self) -> Dict:
        """è·å–ç»Ÿè®¡ä¿¡æ¯"""
        total = len(self.files)
        marked = len(self.get_marked_files())
        total_size = sum(f.size for f in self.files)
        languages = set(f.language for f in self.files)
        
        return {
            'total': total,
            'marked': marked,
            'size': total_size,
            'languages': len(languages)
        }
    
    def filter_files(self, 
                    search: Optional[str] = None,
                    language: Optional[str] = None) -> List[FileInfo]:
        """ç­›é€‰æ–‡ä»¶"""
        result = self.files
        
        if search:
            search = search.lower()
            result = [f for f in result if search in f.name.lower()]
        
        if language and language != "å…¨éƒ¨è¯­è¨€":
            result = [f for f in result if f.language == language]
        
        return result

def get_language(file_path: str) -> str:
    """æ ¹æ®æ–‡ä»¶æ‰©å±•åè·å–ç¼–ç¨‹è¯­è¨€"""
    _, ext = os.path.splitext(file_path.lower())
    
    for language, extensions in LANGUAGE_EXTENSIONS.items():
        if ext in extensions:
            return language
    
    return "Text"

def get_all_languages() -> List[str]:
    """è·å–æ‰€æœ‰æ”¯æŒçš„è¯­è¨€"""
    return sorted(LANGUAGE_EXTENSIONS.keys())

def scan_folder(folder_path: str, recursive: bool = True) -> List[str]:
    """æ‰«ææ–‡ä»¶å¤¹è·å–æ‰€æœ‰æ”¯æŒçš„æ–‡ä»¶"""
    supported_files = []
    all_extensions = [ext for exts in LANGUAGE_EXTENSIONS.values() for ext in exts]
    
    if recursive:
        for root, _, files in os.walk(folder_path):
            for file in files:
                file_path = os.path.join(root, file)
                _, ext = os.path.splitext(file_path.lower())
                if ext in all_extensions:
                    supported_files.append(file_path)
    else:
        for file in os.listdir(folder_path):
            file_path = os.path.join(folder_path, file)
            if os.path.isfile(file_path):
                _, ext = os.path.splitext(file_path.lower())
                if ext in all_extensions:
                    supported_files.append(file_path)
    
    return supported_files

def format_size(size_bytes: int) -> str:
    """æ ¼å¼åŒ–æ–‡ä»¶å¤§å°"""
    if size_bytes < 1024:
        return f"{size_bytes} B"
    elif size_bytes < 1024 * 1024:
        return f"{size_bytes / 1024:.1f} KB"
    elif size_bytes < 1024 * 1024 * 1024:
        return f"{size_bytes / (1024 * 1024):.1f} MB"
    else:
        return f"{size_bytes / (1024 * 1024 * 1024):.1f} GB"
```

### 5. `core/converter.py` - è½¬æ¢é€»è¾‘

```python
"""
Markdown è½¬æ¢æ ¸å¿ƒæ¨¡å—
"""

import os
import time
from typing import Callable, Optional
from core.file_handler import FileInfo

# Markdown æ¨¡æ¿
TEMPLATES = {
    "é»˜è®¤": """# {relative_path}

```{language}
{content}
```

---

""",
    
    "è¯¦ç»†ä¿¡æ¯": """## ğŸ“„ {basename}

**è·¯å¾„:** `{relative_path}`  
**è¯­è¨€:** {language}  
**å¤§å°:** {size}  
**ä¿®æ”¹æ—¶é—´:** {mtime}

```{language}
{content}
```

---

""",
    
    "GitHub é£æ ¼": """## {basename}

```{language}
{content}
```

<details>
<summary>ğŸ“‹ æ–‡ä»¶ä¿¡æ¯</summary>

- **å®Œæ•´è·¯å¾„:** `{relative_path}`
- **ç¼–ç¨‹è¯­è¨€:** {language}
- **æ–‡ä»¶å¤§å°:** {size}
- **æœ€åä¿®æ”¹:** {mtime}

</details>

---

""",
    
    "ç®€æ´æ¨¡å¼": """```{language}
// {relative_path}
{content}
```

""",
    
    "å¸¦ç›®å½•": """### {relative_path}

<details open>
<summary>ç‚¹å‡»å±•å¼€/æŠ˜å </summary>

```{language}
{content}
```

</details>

""",
    
    "ä¸“ä¸šæ–‡æ¡£": """## {basename}

> ğŸ“ è·¯å¾„: `{relative_path}`  
> ğŸ·ï¸ è¯­è¨€: **{language}**  
> ğŸ“¦ å¤§å°: {size}

```{language}
{content}
```

**æœ€åä¿®æ”¹:** {mtime}

---

"""
}

class Converter:
    """Markdown è½¬æ¢å™¨"""
    
    def __init__(self, template: str = "é»˜è®¤"):
        self.template = template
        self.base_path = os.getcwd()
    
    def set_template(self, template: str):
        """è®¾ç½®æ¨¡æ¿"""
        if template in TEMPLATES:
            self.template = template
    
    def set_base_path(self, path: str):
        """è®¾ç½®åŸºå‡†è·¯å¾„ï¼ˆç”¨äºè®¡ç®—ç›¸å¯¹è·¯å¾„ï¼‰"""
        self.base_path = path
    
    def convert_file(self, file_info: FileInfo) -> str:
        """è½¬æ¢å•ä¸ªæ–‡ä»¶"""
        try:
            # è¯»å–æ–‡ä»¶å†…å®¹
            with open(file_info.path, 'r', encoding='utf-8') as f:
                content = f.read()
            
            # å‡†å¤‡æ¨¡æ¿å˜é‡
            basename = os.path.basename(file_info.path)
            
            try:
                relative_path = os.path.relpath(file_info.path, self.base_path)
            except ValueError:
                relative_path = file_info.path
            
            mtime = time.strftime(
                "%Y-%m-%d %H:%M:%S",
                time.localtime(os.path.getmtime(file_info.path))
            )
            
            from core.file_handler import format_size
            size = format_size(file_info.size)
            
            # åº”ç”¨æ¨¡æ¿
            template = TEMPLATES.get(self.template, TEMPLATES["é»˜è®¤"])
            
            return template.format(
                basename=basename,
                relative_path=relative_path,
                language=file_info.language.lower(),
                size=size,
                mtime=mtime,
                content=content
            )
            
        except Exception as e:
            return f"<!-- âŒ é”™è¯¯: æ— æ³•å¤„ç†æ–‡ä»¶ {file_info.path}: {str(e)} -->\n\n"
    
    def convert_files(self, 
                     files: list[FileInfo],
                     output_path: str,
                     progress_callback: Optional[Callable[[int, int, str], None]] = None) -> dict:
        """
        æ‰¹é‡è½¬æ¢æ–‡ä»¶
        
        Args:
            files: æ–‡ä»¶åˆ—è¡¨
            output_path: è¾“å‡ºæ–‡ä»¶è·¯å¾„
            progress_callback: è¿›åº¦å›è°ƒå‡½æ•° (current, total, filename)
        
        Returns:
            dict: è½¬æ¢ç»“æœç»Ÿè®¡
        """
        total = len(files)
        success = 0
        errors = []
        
        try:
            with open(output_path, 'w', encoding='utf-8') as f:
                # å†™å…¥æ–‡æ¡£å¤´éƒ¨
                f.write(self._generate_header(files))
                
                # è½¬æ¢æ¯ä¸ªæ–‡ä»¶
                for i, file_info in enumerate(files, 1):
                    try:
                        # å›è°ƒè¿›åº¦
                        if progress_callback:
                            progress_callback(i, total, file_info.name)
                        
                        # è½¬æ¢å¹¶å†™å…¥
                        markdown = self.convert_file(file_info)
                        f.write(markdown)
                        success += 1
                        
                    except Exception as e:
                        errors.append({
                            'file': file_info.path,
                            'error': str(e)
                        })
                
                # å†™å…¥æ–‡æ¡£å°¾éƒ¨
                f.write(self._generate_footer(success, total))
        
        except Exception as e:
            return {
                'success': False,
                'message': f'å†™å…¥è¾“å‡ºæ–‡ä»¶å¤±è´¥: {str(e)}',
                'converted': 0,
                'total': total,
                'errors': errors
            }
        
        return {
            'success': True,
            'message': f'æˆåŠŸè½¬æ¢ {success}/{total} ä¸ªæ–‡ä»¶',
            'converted': success,
            'total': total,
            'errors': errors
        }
    
    def _generate_header(self, files: list[FileInfo]) -> str:
        """ç”Ÿæˆæ–‡æ¡£å¤´éƒ¨"""
        from core.file_handler import format_size
        
        total_size = sum(f.size for f in files)
        languages = set(f.language for f in files)
        
        header = f"""# ğŸ“š Code to Markdown

**ç”Ÿæˆæ—¶é—´:** {time.strftime("%Y-%m-%d %H:%M:%S")}  
**æ–‡ä»¶æ•°é‡:** {len(files)}  
**æ€»å¤§å°:** {format_size(total_size)}  
**ç¼–ç¨‹è¯­è¨€:** {', '.join(sorted(languages))}  
**ä½¿ç”¨æ¨¡æ¿:** {self.template}

---

"""
        return header
    
    def _generate_footer(self, success: int, total: int) -> str:
        """ç”Ÿæˆæ–‡æ¡£å°¾éƒ¨"""
        footer = f"""

---

## ğŸ“Š è½¬æ¢ç»Ÿè®¡

- âœ… æˆåŠŸè½¬æ¢: **{success}** ä¸ªæ–‡ä»¶
- ğŸ“ æ€»è®¡å¤„ç†: **{total}** ä¸ªæ–‡ä»¶
- ğŸ• å®Œæˆæ—¶é—´: {time.strftime("%Y-%m-%d %H:%M:%S")}

---

*ç”± Code2Markdown ç”Ÿæˆ - Material Design 3 ç‰ˆæœ¬*
"""
        return footer

def get_template_names() -> list[str]:
    """è·å–æ‰€æœ‰æ¨¡æ¿åç§°"""
    return list(TEMPLATES.keys())

def preview_template(template_name: str) -> str:
    """é¢„è§ˆæ¨¡æ¿å†…å®¹"""
    return TEMPLATES.get(template_name, TEMPLATES["é»˜è®¤"])
```

### 6. `ui/widgets/material_card.py` - Material å¡ç‰‡ç»„ä»¶

```python
"""
Material Design å¡ç‰‡ç»„ä»¶
"""

import customtkinter as ctk
from config.theme import MD

class MaterialCard(ctk.CTkFrame):
    """Material Design å¡ç‰‡"""
    
    def __init__(self, master, elevation=1, **kwargs):
        # æ ¹æ®é«˜ç¨‹é€‰æ‹©èƒŒæ™¯è‰²
        surface_colors = {
            0: MD.SURFACE,
            1: MD.SURFACE_1,
            2: MD.SURFACE_2,
            3: MD.SURFACE_3,
            4: MD.SURFACE_4,
            5: MD.SURFACE_5
        }
        
        fg_color = kwargs.pop('fg_color', surface_colors.get(elevation, MD.SURFACE_1))
        corner_radius = kwargs.pop('corner_radius', MD.RADIUS_MEDIUM)
        
        super().__init__(
            master,
            fg_color=fg_color,
            corner_radius=corner_radius,
            **kwargs
        )
        
        self.elevation = elevation

class MaterialButton(ctk.CTkButton):
    """Material Design æŒ‰é’®"""
    
    STYLES = {
        'filled': {
            'fg_color': MD.PRIMARY,
            'hover_color': MD.PRIMARY_CONTAINER,
            'text_color': MD.ON_PRIMARY
        },
        'tonal': {
            'fg_color': MD.SECONDARY_CONTAINER,
            'hover_color': MD.SECONDARY,
            'text_color': MD.ON_SECONDARY_CONTAINER
        },
        'outlined': {
            'fg_color': 'transparent',
            'hover_color': MD.SURFACE_2,
            'text_color': MD.PRIMARY,
            'border_width': 1,
            'border_color': MD.OUTLINE
        },
        'text': {
            'fg_color': 'transparent',
            'hover_color': MD.SURFACE_2,
            'text_color': MD.PRIMARY
        },
        'error': {
            'fg_color': MD.ERROR,
            'hover_color': MD.ERROR_CONTAINER,
            'text_color': MD.ON_ERROR
        },
        'success': {
            'fg_color': MD.SUCCESS,
            'hover_color': MD.SUCCESS_CONTAINER,
            'text_color': MD.ON_PRIMARY
        }
    }
    
    def __init__(self, master, style='filled', **kwargs):
        style_props = self.STYLES.get(style, self.STYLES['filled']).copy()
        
        # åˆå¹¶æ ·å¼å±æ€§å’Œç”¨æˆ·å±æ€§
        for key, value in style_props.items():
            kwargs.setdefault(key, value)
        
        kwargs.setdefault('corner_radius', MD.RADIUS_LARGE)
        kwargs.setdefault('font', MD.FONT_LABEL)
        kwargs.setdefault('height', 40)
        
        super().__init__(master, **kwargs)

class MaterialEntry(ctk.CTkEntry):
    """Material Design è¾“å…¥æ¡†"""
    
    def __init__(self, master, **kwargs):
        kwargs.setdefault('fg_color', MD.SURFACE_2)
        kwargs.setdefault('border_color', MD.OUTLINE)
        kwargs.setdefault('text_color', MD.ON_SURFACE)
        kwargs.setdefault('placeholder_text_color', MD.ON_SURFACE_VARIANT)
        kwargs.setdefault('corner_radius', MD.RADIUS_SMALL)
        kwargs.setdefault('font', MD.FONT_BODY)
        kwargs.setdefault('height', 40)
        
        super().__init__(master, **kwargs)

class StatCard(MaterialCard):
    """ç»Ÿè®¡å¡ç‰‡ç»„ä»¶"""
    
    def __init__(self, master, icon: str, label: str, value: str = "0", **kwargs):
        super().__init__(master, elevation=0, **kwargs)
        
        self.configure(fg_color=MD.SURFACE_2)
        
        # å†…è¾¹è·å®¹å™¨
        container = ctk.CTkFrame(self, fg_color='transparent')
        container.pack(fill='both', expand=True, padx=MD.SPACING_SM, pady=MD.SPACING_SM)
        
        # å›¾æ ‡
        self.icon_label = ctk.CTkLabel(
            container,
            text=icon,
            font=("Segoe UI Emoji", 20),
            text_color=MD.PRIMARY
        )
        self.icon_label.pack(anchor='w')
        
        # æ•°å€¼
        self.value_label = ctk.CTkLabel(
            container,
            text=value,
            font=MD.FONT_TITLE,
            text_color=MD.ON_SURFACE
        )
        self.value_label.pack(anchor='w', pady=(MD.SPACING_XS, 0))
        
        # æ ‡ç­¾
        self.label_label = ctk.CTkLabel(
            container,
            text=label,
            font=MD.FONT_LABEL,
            text_color=MD.ON_SURFACE_VARIANT
        )
        self.label_label.pack(anchor='w')
    
    def update_value(self, value: str):
        """æ›´æ–°æ•°å€¼"""
        self.value_label.configure(text=value)
```

### 7. `ui/components/file_list_panel.py` - æ–‡ä»¶åˆ—è¡¨é¢æ¿

```python
"""
æ–‡ä»¶åˆ—è¡¨é¢æ¿ç»„ä»¶
"""

import customtkinter as ctk
import tkinter as tk
from tkinter import filedialog
from config.theme import MD
from ui.widgets.material_card import MaterialCard, MaterialButton, MaterialEntry
from core.file_handler import FileHandler, get_all_languages, format_size

class FileListPanel(MaterialCard):
    """æ–‡ä»¶åˆ—è¡¨é¢æ¿"""
    
    def __init__(self, master, file_handler: FileHandler, **kwargs):
        super().__init__(master, elevation=1, **kwargs)
        
        self.file_handler = file_handler
        self.on_update_callback = None
        
        self._build_ui()
    
    def _build_ui(self):
        """æ„å»ºUI"""
        # ä¸»å®¹å™¨
        container = ctk.CTkFrame(self, fg_color='transparent')
        container.pack(fill='both', expand=True, padx=MD.SPACING_MD, pady=MD.SPACING_MD)
        
        # æ ‡é¢˜æ 
        self._build_header(container)
        
        # æœç´¢å’Œç­›é€‰æ 
        self._build_search_bar(container)
        
        # æ“ä½œæŒ‰é’®æ 
        self._build_action_bar(container)
        
        # æ–‡ä»¶åˆ—è¡¨
        self._build_file_list(container)
        
        # åº•éƒ¨ç»Ÿè®¡
        self._build_footer(container)
    
    def _build_header(self, parent):
        """æ„å»ºæ ‡é¢˜æ """
        header = ctk.CTkFrame(parent, fg_color='transparent')
        header.pack(fill='x', pady=(0, MD.SPACING_MD))
        
        # æ ‡é¢˜
        title_container = ctk.CTkFrame(header, fg_color='transparent')
        title_container.pack(side='left')
        
        ctk.CTkLabel(
            title_container,
            text="æ–‡ä»¶ç®¡ç†",
            font=MD.FONT_HEADLINE,
            text_color=MD.ON_SURFACE
        ).pack(side='left')
        
        ctk.CTkLabel(
            title_container,
            text="ğŸ“",
            font=("Segoe UI Emoji", 24)
        ).pack(side='left', padx=(MD.SPACING_SM, 0))
    
    def _build_search_bar(self, parent):
        """æ„å»ºæœç´¢æ """
        search_bar = ctk.CTkFrame(parent, fg_color='transparent')
        search_bar.pack(fill='x', pady=(0, MD.SPACING_MD))
        
        # æœç´¢æ¡†
        self.search_var = tk.StringVar()
        self.search_var.trace('w', lambda *args: self._filter_files())
        
        search_entry = MaterialEntry(
            search_bar,
            textvariable=self.search_var,
            placeholder_text="ğŸ” æœç´¢æ–‡ä»¶å...",
            width=300
        )
        search_entry.pack(side='left', fill='x', expand=True, padx=(0, MD.SPACING_SM))
        
        # è¯­è¨€ç­›é€‰
        self.language_var = tk.StringVar(value="å…¨éƒ¨è¯­è¨€")
        self.language_var.trace('w', lambda *args: self._filter_files())
        
        languages = ["å…¨éƒ¨è¯­è¨€"] + get_all_languages()
        language_combo = ctk.CTkComboBox(
            search_bar,
            values=languages,
            variable=self.language_var,
            state='readonly',
            width=150,
            fg_color=MD.SURFACE_2,
            button_color=MD.PRIMARY,
            border_color=MD.OUTLINE,
            font=MD.FONT_BODY
        )
        language_combo.pack(side='left')
    
    def _build_action_bar(self, parent):
        """æ„å»ºæ“ä½œæŒ‰é’®æ """
        action_bar = ctk.CTkFrame(parent, fg_color='transparent')
        action_bar.pack(fill='x', pady=(0, MD.SPACING_MD))
        
        # å·¦ä¾§æŒ‰é’®
        left_buttons = ctk.CTkFrame(action_bar, fg_color='transparent')
        left_buttons.pack(side='left')
        
        MaterialButton(
            left_buttons,
            text="ğŸ“„ æ·»åŠ æ–‡ä»¶",
            command=self._add_files,
            style='filled',
            width=120
        ).pack(side='left', padx=(0, MD.SPACING_SM))
        
        MaterialButton(
            left_buttons,
            text="ğŸ“ æ·»åŠ æ–‡ä»¶å¤¹",
            command=self._add_folder,
            style='tonal',
            width=120
        ).pack(side='left', padx=(0, MD.SPACING_SM))
        
        MaterialButton(
            left_buttons,
            text="ğŸ—‘ï¸ æ¸…ç©º",
            command=self._clear_files,
            style='error',
            width=100
        ).pack(side='left')
        
        # å³ä¾§æŒ‰é’®
        right_buttons = ctk.CTkFrame(action_bar, fg_color='transparent')
        right_buttons.pack(side='right')
        
        MaterialButton(
            right_buttons,
            text="å…¨é€‰",
            command=lambda: self._mark_all(True),
            style='outlined',
            width=80
        ).pack(side='left', padx=(0, MD.SPACING_SM))
        
        MaterialButton(
            right_buttons,
            text="å…¨ä¸é€‰",
            command=lambda: self._mark_all(False),
            style='outlined',
            width=80
        ).pack(side='left')
    
    def _build_file_list(self, parent):
        """æ„å»ºæ–‡ä»¶åˆ—è¡¨"""
        # åˆ—è¡¨å®¹å™¨
        list_container = ctk.CTkFrame(parent, fg_color=MD.SURFACE)
        list_container.pack(fill='both', expand=True, pady=(0, MD.SPACING_MD))
        
        # æ–‡æœ¬æ¡†
        self.file_textbox = ctk.CTkTextbox(
            list_container,
            font=MD.FONT_MONO,
            fg_color=MD.SURFACE,
            text_color=MD.ON_SURFACE,
            wrap='none'
        )
        self.file_textbox.pack(fill='both', expand=True)
        
        # ç»‘å®šäº‹ä»¶
        self.file_textbox.bind('<Button-1>', self._on_file_click)
        self.file_textbox.bind('<space>', lambda e: self._toggle_current_mark())
    
    def _build_footer(self, parent):
        """æ„å»ºåº•éƒ¨ç»Ÿè®¡"""
        footer = ctk.CTkFrame(parent, fg_color='transparent')
        footer.pack(fill='x')
        
        self.stats_label = ctk.CTkLabel(
            footer,
            text="0 ä¸ªæ–‡ä»¶",
            font=MD.FONT_BODY,
            text_color=MD.ON_SURFACE_VARIANT
        )
        self.stats_label.pack(side='left')
    
    # äº‹ä»¶å¤„ç†
    def _add_files(self):
        """æ·»åŠ æ–‡ä»¶"""
        filetypes = [
            ("æ‰€æœ‰æ”¯æŒçš„æ–‡ä»¶", "*.py *.js *.java *.cpp *.html *.css"),
            ("æ‰€æœ‰æ–‡ä»¶", "*.*")
        ]
        
        files = filedialog.askopenfilenames(title="é€‰æ‹©ä»£ç æ–‡ä»¶", filetypes=filetypes)
        
        if files:
            count = self.file_handler.add_files(list(files))
            self.refresh()
            
            if self.on_update_callback:
                self.on_update_callback(f"âœ… æ·»åŠ äº† {count} ä¸ªæ–‡ä»¶", 'success')
    
    def _add_folder(self):
        """æ·»åŠ æ–‡ä»¶å¤¹"""
        folder = filedialog.askdirectory(title="é€‰æ‹©æ–‡ä»¶å¤¹")
        
        if folder:
            count = self.file_handler.add_folder(folder)
            self.refresh()
            
            if self.on_update_callback:
                self.on_update_callback(f"âœ… ä»æ–‡ä»¶å¤¹æ·»åŠ äº† {count} ä¸ªæ–‡ä»¶", 'success')
    
    def _clear_files(self):
        """æ¸…ç©ºæ–‡ä»¶"""
        if not self.file_handler.files:
            return
        
        # ç®€åŒ–ç‰ˆç¡®è®¤ï¼ˆå¯ä»¥åç»­æ›¿æ¢ä¸ºè‡ªå®šä¹‰å¯¹è¯æ¡†ï¼‰
        from tkinter import messagebox
        if messagebox.askyesno("ç¡®è®¤æ¸…ç©º", "ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ–‡ä»¶å—ï¼Ÿ"):
            self.file_handler.clear()
            self.refresh()
            
            if self.on_update_callback:
                self.on_update_callback("ğŸ—‘ï¸ å·²æ¸…ç©ºæ–‡ä»¶åˆ—è¡¨", 'info')
    
    def _mark_all(self, marked: bool):
        """å…¨é€‰/å…¨ä¸é€‰"""
        self.file_handler.mark_all(marked)
        self.refresh()
        
        if self.on_update_callback:
            msg = "âœ… å·²å…¨é€‰" if marked else "â¬œ å·²å–æ¶ˆå…¨é€‰"
            self.on_update_callback(msg, 'info')
    
    def _filter_files(self):
        """ç­›é€‰æ–‡ä»¶"""
        search = self.search_var.get()
        language = self.language_var.get()
        
        filtered = self.file_handler.filter_files(
            search=search if search else None,
            language=language if language != "å…¨éƒ¨è¯­è¨€" else None
        )
        
        self._display_files(filtered)
    
    def _on_file_click(self, event):
        """æ–‡ä»¶ç‚¹å‡»äº‹ä»¶"""
        # è·å–ç‚¹å‡»ä½ç½®çš„è¡Œ
        index = self.file_textbox.index(f"@{event.x},{event.y}")
        line_num = int(index.split('.')[0])
        
        # è·å–è¯¥è¡Œå†…å®¹
        line_start = f"{line_num}.0"
        line_end = f"{line_num}.end"
        line_content = self.file_textbox.get(line_start, line_end)
        
        # è§£ææ–‡ä»¶åå¹¶åˆ‡æ¢æ ‡è®°
        if line_content.strip():
            parts = line_content.strip().split('â”‚')
            if len(parts) >= 2:
                filename = parts[1].strip().lstrip('âœ“ ').lstrip('â˜ ')
                
                # æ‰¾åˆ°å¯¹åº”æ–‡ä»¶å¹¶åˆ‡æ¢æ ‡è®°
                for file_info in self.file_handler.files:
                    if file_info.name == filename:
                        self.file_handler.toggle_mark(file_info.path)
                        self.refresh()
                        break
    
    def _toggle_current_mark(self):
        """åˆ‡æ¢å½“å‰è¡Œçš„æ ‡è®°çŠ¶æ€"""
        cursor_pos = self.file_textbox.index(tk.INSERT)
        line_num = int(cursor_pos.split('.')[0])
        
        line_start = f"{line_num}.0"
        line_end = f"{line_num}.end"
        line_content = self.file_textbox.get(line_start, line_end)
        
        if line_content.strip():
            parts = line_content.strip().split('â”‚')
            if len(parts) >= 2:
                filename = parts[1].strip().lstrip('âœ“ ').lstrip('â˜ ')
                
                for file_info in self.file_handler.files:
                    if file_info.name == filename:
                        self.file_handler.toggle_mark(file_info.path)
                        self.refresh()
                        break
    
    def _display_files(self, files):
        """æ˜¾ç¤ºæ–‡ä»¶åˆ—è¡¨"""
        self.file_textbox.delete('1.0', 'end')
        
        if not files:
            self.file_textbox.insert('end', '\n  æš‚æ— æ–‡ä»¶\n\n  ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®æ·»åŠ æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹')
            return
        
        # è¡¨å¤´
        header = f"{'çŠ¶æ€':^6}â”‚ {'æ–‡ä»¶å':<40} â”‚ {'è¯­è¨€':<15} â”‚ {'å¤§å°':<10}\n"
        separator = "â”€" * 80 + "\n"
        
        self.file_textbox.insert('end', header)
        self.file_textbox.insert('end', separator)
        
        # æ–‡ä»¶åˆ—è¡¨
        for file_info in files:
            icon = "âœ“" if file_info.marked else "â˜"
            name = file_info.name[:38] + '..' if len(file_info.name) > 40 else file_info.name
            language = file_info.language
            size = format_size(file_info.size)
            
            line = f"  {icon:^4}â”‚ {name:<40} â”‚ {language:<15} â”‚ {size:<10}\n"
            self.file_textbox.insert('end', line)
    
    def refresh(self):
        """åˆ·æ–°æ˜¾ç¤º"""
        self._filter_files()
        
        # æ›´æ–°ç»Ÿè®¡
        stats = self.file_handler.get_stats()
        self.stats_label.configure(
            text=f"{stats['marked']}/{stats['total']} ä¸ªæ–‡ä»¶å·²é€‰ä¸­  â€¢  "
                 f"å…± {format_size(stats['size'])}  â€¢  "
                 f"{stats['languages']} ç§è¯­è¨€"
        )
    
    def set_update_callback(self, callback):
        """è®¾ç½®æ›´æ–°å›è°ƒ"""
        self.on_update_callback = callback
```

### 8. `ui/components/control_panel.py` - æ§åˆ¶é¢æ¿

```python
"""
æ§åˆ¶é¢æ¿ç»„ä»¶
"""

import customtkinter as ctk
import tkinter as tk
from config.theme import MD
from ui.widgets.material_card import MaterialCard, MaterialButton, StatCard
from core.converter import get_template_names, Converter
from core.file_handler import FileHandler, format_size

class ControlPanel(MaterialCard):
    """æ§åˆ¶é¢æ¿"""
    
    def __init__(self, master, file_handler: FileHandler, **kwargs):
        super().__init__(master, elevation=1, **kwargs)
        
        self.file_handler = file_handler
        self.converter = Converter()
        
        self.on_preview_callback = None
        self.on_convert_callback = None
        
        self._build_ui()
    
    def _build_ui(self):
        """æ„å»ºUI"""
        container = ctk.CTkFrame(self, fg_color='transparent')
        container.pack(fill='both', expand=True, padx=MD.SPACING_MD, pady=MD.SPACING_MD)
        
        # æ ‡é¢˜
        self._build_header(container)
        
        # æ¨¡æ¿é€‰æ‹©
        self._build_template_section(container)
        
        # ç»Ÿè®¡å¡ç‰‡
        self._build_stats_section(container)
        
        # æ“ä½œæŒ‰é’®
        self._build_actions(container)
        
        # è¿›åº¦æ˜¾ç¤º
        self._build_progress(container)
    
    def _build_header(self, parent):
        """æ„å»ºæ ‡é¢˜"""
        header = ctk.CTkFrame(parent, fg_color='transparent')
        header.pack(fill='x', pady=(0, MD.SPACING_LG))
        
        title_container = ctk.CTkFrame(header, fg_color='transparent')
        title_container.pack(anchor='w')
        
        ctk.CTkLabel(
            title_container,
            text="è½¬æ¢è®¾ç½®",
            font=MD.FONT_HEADLINE,
            text_color=MD.ON_SURFACE
        ).pack(side='left')
        
        ctk.CTkLabel(
            title_container,
            text="âš™ï¸",
            font=("Segoe UI Emoji", 24)
        ).pack(side='left', padx=(MD.SPACING_SM, 0))
    
    def _build_template_section(self, parent):
        """æ„å»ºæ¨¡æ¿é€‰æ‹©åŒºåŸŸ"""
        section = MaterialCard(parent, elevation=0, fg_color=MD.SURFACE_2)
        section.pack(fill='x', pady=(0, MD.SPACING_MD))
        
        section_container = ctk.CTkFrame(section, fg_color='transparent')
        section_container.pack(fill='both', padx=MD.SPACING_MD, pady=MD.SPACING_MD)
        
        # æ ‡é¢˜
        ctk.CTkLabel(
            section_container,
            text="Markdown æ¨¡æ¿",
            font=MD.FONT_TITLE,
            text_color=MD.ON_SURFACE,
            anchor='w'
        ).pack(fill='x', pady=(0, MD.SPACING_SM))
        
        # æ¨¡æ¿é€‰æ‹©ä¸‹æ‹‰æ¡†
        self.template_var = tk.StringVar(value="é»˜è®¤")
        template_combo = ctk.CTkComboBox(
            section_container,
            values=get_template_names(),
            variable=self.template_var,
            state='readonly',
            fg_color=MD.SURFACE,
            button_color=MD.PRIMARY,
            border_color=MD.OUTLINE,
            font=MD.FONT_BODY,
            command=self._on_template_changed
        )
        template_combo.pack(fill='x', pady=(0, MD.SPACING_SM))
        
        # é¢„è§ˆæŒ‰é’®
        MaterialButton(
            section_container,
            text="ğŸ‘ï¸ é¢„è§ˆæ¨¡æ¿",
            command=self._preview_template,
            style='outlined',
            width=200
        ).pack(fill='x')
    
    def _build_stats_section(self, parent):
        """æ„å»ºç»Ÿè®¡åŒºåŸŸ"""
        # åŒºåŸŸæ ‡é¢˜
        ctk.CTkLabel(
            parent,
            text="ğŸ“Š ç»Ÿè®¡ä¿¡æ¯",
            font=MD.FONT_TITLE,
            text_color=MD.ON_SURFACE,
            anchor='w'
        ).pack(fill='x', pady=(MD.SPACING_MD, MD.SPACING_SM))
        
        # ç»Ÿè®¡å¡ç‰‡ç½‘æ ¼
        stats_grid = ctk.CTkFrame(parent, fg_color='transparent')
        stats_grid.pack(fill='x', pady=(0, MD.SPACING_MD))
        
        stats_grid.grid_columnconfigure(0, weight=1)
        stats_grid.grid_columnconfigure(1, weight=1)
        
        # åˆ›å»ºç»Ÿè®¡å¡ç‰‡
        self.stat_cards = {
            'total': StatCard(stats_grid, "ğŸ“„", "æ€»æ–‡ä»¶", "0"),
            'marked': StatCard(stats_grid, "âœ…", "å·²é€‰ä¸­", "0"),
            'size': StatCard(stats_grid, "ğŸ’¾", "æ€»å¤§å°", "0 B"),
            'languages': StatCard(stats_grid, "ğŸ·ï¸", "è¯­è¨€æ•°", "0")
        }
        
        self.stat_cards['total'].grid(row=0, column=0, sticky='ew', padx=(0, MD.SPACING_XS), pady=(0, MD.SPACING_XS))
        self.stat_cards['marked'].grid(row=0, column=1, sticky='ew', padx=(MD.SPACING_XS, 0), pady=(0, MD.SPACING_XS))
        self.stat_cards['size'].grid(row=1, column=0, sticky='ew', padx=(0, MD.SPACING_XS), pady=(MD.SPACING_XS, 0))
        self.stat_cards['languages'].grid(row=1, column=1, sticky='ew', padx=(MD.SPACING_XS, 0), pady=(MD.SPACING_XS, 0))
    
    def _build_actions(self, parent):
        """æ„å»ºæ“ä½œæŒ‰é’®"""
        actions = ctk.CTkFrame(parent, fg_color='transparent')
        actions.pack(fill='x', pady=(MD.SPACING_LG, 0))
        
        MaterialButton(
            actions,
            text="ğŸ‘ï¸ é¢„è§ˆè½¬æ¢ç»“æœ",
            command=self._preview_conversion,
            style='tonal',
            height=48
        ).pack(fill='x', pady=(0, MD.SPACING_SM))
        
        MaterialButton(
            actions,
            text="ğŸš€ å¼€å§‹è½¬æ¢",
            command=self._start_conversion,
            style='success',
            height=56,
            font=MD.FONT_BODY_LARGE
        ).pack(fill='x')
    
    def _build_progress(self, parent):
        """æ„å»ºè¿›åº¦æ˜¾ç¤º"""
        self.progress_container = ctk.CTkFrame(parent, fg_color='transparent')
        self.progress_container.pack(fill='x', pady=(MD.SPACING_MD, 0))
        
        self.progress_bar = ctk.CTkProgressBar(
            self.progress_container,
            height=8,
            corner_radius=4,
            fg_color=MD.SURFACE_2,
            progress_color=MD.PRIMARY
        )
        
        self.progress_label = ctk.CTkLabel(
            self.progress_container,
            text="",
            font=MD.FONT_LABEL,
            text_color=MD.ON_SURFACE_VARIANT
        )
        
        # åˆå§‹éšè—
        self.hide_progress()
    
    # äº‹ä»¶å¤„ç†
    def _on_template_changed(self, template_name):
        """æ¨¡æ¿æ”¹å˜äº‹ä»¶"""
        self.converter.set_template(template_name)
    
    def _preview_template(self):
        """é¢„è§ˆæ¨¡æ¿"""
        if self.on_preview_callback:
            self.on_preview_callback('template', self.template_var.get())
    
    def _preview_conversion(self):
        """é¢„è§ˆè½¬æ¢"""
        marked_files = self.file_handler.get_marked_files()
        
        if not marked_files:
            if self.on_preview_callback:
                self.on_preview_callback('warning', 'è¯·å…ˆé€‰æ‹©è¦é¢„è§ˆçš„æ–‡ä»¶')
            return
        
        if self.on_preview_callback:
            self.on_preview_callback('conversion', marked_files)
    
    def _start_conversion(self):
        """å¼€å§‹è½¬æ¢"""
        marked_files = self.file_handler.get_marked_files()
        
        if not marked_files:
            if self.on_convert_callback:
                self.on_convert_callback('warning', 'è¯·å…ˆé€‰æ‹©è¦è½¬æ¢çš„æ–‡ä»¶')
            return
        
        if self.on_convert_callback:
            self.on_convert_callback('start', marked_files)
    
    def update_stats(self):
        """æ›´æ–°ç»Ÿè®¡ä¿¡æ¯"""
        stats = self.file_handler.get_stats()
        
        self.stat_cards['total'].update_value(str(stats['total']))
        self.stat_cards['marked'].update_value(str(stats['marked']))
        self.stat_cards['size'].update_value(format_size(stats['size']))
        self.stat_cards['languages'].update_value(str(stats['languages']))
    
    def show_progress(self):
        """æ˜¾ç¤ºè¿›åº¦æ¡"""
        self.progress_bar.pack(fill='x', pady=(0, MD.SPACING_SM))
        self.progress_label.pack()
        self.progress_bar.set(0)
    
    def hide_progress(self):
        """éšè—è¿›åº¦æ¡"""
        self.progress_bar.pack_forget()
        self.progress_label.pack_forget()
    
    def update_progress(self, current: int, total: int, filename: str = ""):
        """æ›´æ–°è¿›åº¦"""
        progress = current / total if total > 0 else 0
        self.progress_bar.set(progress)
        self.progress_label.configure(
            text=f"æ­£åœ¨å¤„ç†: {filename} ({current}/{total})"
        )
    
    def set_preview_callback(self, callback):
        """è®¾ç½®é¢„è§ˆå›è°ƒ"""
        self.on_preview_callback = callback
    
    def set_convert_callback(self, callback):
        """è®¾ç½®è½¬æ¢å›è°ƒ"""
        self.on_convert_callback = callback
    
    def get_template(self) -> str:
        """è·å–å½“å‰æ¨¡æ¿"""
        return self.template_var.get()
```

### 9. `ui/components/dialogs.py` - å¯¹è¯æ¡†ç»„ä»¶

```python
"""
å¯¹è¯æ¡†ç»„ä»¶
"""

import customtkinter as ctk
from config.theme import MD
from ui.widgets.material_card import MaterialButton
from core.converter import preview_template, Converter
from core.file_handler import FileInfo

class PreviewDialog(ctk.CTkToplevel):
    """é¢„è§ˆå¯¹è¯æ¡†åŸºç±»"""
    
    def __init__(self, parent, title: str, width: int = 800, height: int = 600):
        super().__init__(parent)
        
        self.title(title)
        self.geometry(f"{width}x{height}")
        self.configure(fg_color=MD.BACKGROUND)
        
        # å±…ä¸­æ˜¾ç¤º
        self.update_idletasks()
        x = (self.winfo_screenwidth() // 2) - (width // 2)
        y = (self.winfo_screenheight() // 2) - (height // 2)
        self.geometry(f"{width}x{height}+{x}+{y}")
        
        # æ¨¡æ€
        self.transient(parent)
        self.grab_set()
    
    def _build_header(self, title: str, subtitle: str = ""):
        """æ„å»ºå¤´éƒ¨"""
        header = ctk.CTkFrame(self, fg_color=MD.SURFACE_1, height=80)
        header.pack(fill='x', padx=MD.SPACING_LG, pady=MD.SPACING_LG)
        header.pack_propagate(False)
        
        header_content = ctk.CTkFrame(header, fg_color='transparent')
        header_content.pack(fill='both', expand=True, padx=MD.SPACING_MD, pady=MD.SPACING_MD)
        
        ctk.CTkLabel(
            header_content,
            text=title,
            font=MD.FONT_HEADLINE,
            text_color=MD.ON_SURFACE
        ).pack(anchor='w')
        
        if subtitle:
            ctk.CTkLabel(
                header_content,
                text=subtitle,
                font=MD.FONT_BODY,
                text_color=MD.ON_SURFACE_VARIANT
            ).pack(anchor='w', pady=(MD.SPACING_XS, 0))
        
        return header
    
    def _build_content_area(self):
        """æ„å»ºå†…å®¹åŒºåŸŸ"""
        content = ctk.CTkFrame(self, fg_color=MD.SURFACE)
        content.pack(fill='both', expand=True, padx=MD.SPACING_LG, pady=(0, MD.SPACING_LG))
        
        textbox = ctk.CTkTextbox(
            content,
            font=MD.FONT_MONO,
            fg_color=MD.SURFACE,
            text_color=MD.ON_SURFACE,
            wrap='none'
        )
        textbox.pack(fill='both', expand=True, padx=MD.SPACING_MD, pady=MD.SPACING_MD)
        
        return textbox
    
    def _build_footer(self):
        """æ„å»ºåº•éƒ¨æŒ‰é’®"""
        footer = ctk.CTkFrame(self, fg_color='transparent')
        footer.pack(fill='x', padx=MD.SPACING_LG, pady=(0, MD.SPACING_LG))
        
        MaterialButton(
            footer,
            text="å…³é—­",
            command=self.destroy,
            style='text',
            width=120
        ).pack(side='right')
        
        return footer

class TemplatePreviewDialog(PreviewDialog):
    """æ¨¡æ¿é¢„è§ˆå¯¹è¯æ¡†"""
    
    def __init__(self, parent, template_name: str):
        super().__init__(parent, f"æ¨¡æ¿é¢„è§ˆ - {template_name}", 700, 500)
        
        self._build_header(
            f"ğŸ“‹ {template_name} æ¨¡æ¿",
            "æŸ¥çœ‹æ¨¡æ¿çš„æ ¼å¼å’Œç»“æ„"
        )
        
        textbox = self._build_content_area()
        
        # æ˜¾ç¤ºæ¨¡æ¿å†…å®¹
        template_content = preview_template(template_name)
        textbox.insert('1.0', template_content)
        textbox.configure(state='disabled')
        
        self._build_footer()

class ConversionPreviewDialog(PreviewDialog):
    """è½¬æ¢é¢„è§ˆå¯¹è¯æ¡†"""
    
    def __init__(self, parent, files: list[FileInfo], template: str, max_files: int = 5):
        super().__init__(parent, "è½¬æ¢é¢„è§ˆ", 900, 700)
        
        self._build_header(
            f"ğŸ‘ï¸ è½¬æ¢é¢„è§ˆ",
            f"ä½¿ç”¨ {template} æ¨¡æ¿  â€¢  é¢„è§ˆå‰ {min(len(files), max_files)} ä¸ªæ–‡ä»¶"
        )
        
        textbox = self._build_content_area()
        
        # ç”Ÿæˆé¢„è§ˆå†…å®¹
        converter = Converter(template)
        preview_content = []
        
        for i, file_info in enumerate(files[:max_files]):
            preview_content.append(converter.convert_file(file_info))
        
        if len(files) > max_files:
            preview_content.append(
                f"\n{'='*80}\n"
                f"... è¿˜æœ‰ {len(files) - max_files} ä¸ªæ–‡ä»¶æœªåœ¨é¢„è§ˆä¸­æ˜¾ç¤º ...\n"
                f"{'='*80}\n"
            )
        
        textbox.insert('1.0', ''.join(preview_content))
        textbox.configure(state='disabled')
        
        self._build_footer()
```

### 10. `ui/app.py` - ä¸»åº”ç”¨çª—å£

```python
"""
ä¸»åº”ç”¨çª—å£
"""

import customtkinter as ctk
from tkinter import filedialog, messagebox
import os

from config.theme import MD
from config.settings import Settings
from core.file_handler import FileHandler
from core.converter import Converter
from ui.components.file_list_panel import FileListPanel
from ui.components.control_panel import ControlPanel
from ui.components.dialogs import TemplatePreviewDialog, ConversionPreviewDialog

class MaterialApp(ctk.CTk):
    """ä¸»åº”ç”¨ç¨‹åº"""
    
    def __init__(self):
        super().__init__()
        
        # åˆå§‹åŒ–
        self.settings = Settings()
        self.file_handler = FileHandler()
        self.converter = Converter()
        
        self._setup_window()
        self._build_ui()
        self._load_saved_state()
        
        # ç»‘å®šå…³é—­äº‹ä»¶
        self.protocol("WM_DELETE_WINDOW", self._on_closing)
    
    def _setup_window(self):
        """è®¾ç½®çª—å£"""
        self.title("Code2Markdown - Material Design 3")
        
        # çª—å£å¤§å°
        width = self.settings.get('window', {}).get('width', 1280)
        height = self.settings.get('window', {}).get('height', 800)
        
        # å±…ä¸­æ˜¾ç¤º
        screen_width = self.winfo_screenwidth()
        screen_height = self.winfo_screenheight()
        x = (screen_width - width) // 2
        y = (screen_height - height) // 2
        
        self.geometry(f"{width}x{height}+{x}+{y}")
        
        # æœ€å°å°ºå¯¸
        min_width = self.settings.get('window', {}).get('min_width', 1000)
        min_height = self.settings.get('window', {}).get('min_height', 600)
        self.minsize(min_width, min_height)
        
        # èƒŒæ™¯è‰²
        self.configure(fg_color=MD.BACKGROUND)
    
    def _build_ui(self):
        """æ„å»ºUI"""
        # é…ç½®ç½‘æ ¼
        self.grid_columnconfigure(0, weight=3)
        self.grid_columnconfigure(1, weight=1)
        self.grid_rowconfigure(0, weight=1)
        
        # æ–‡ä»¶åˆ—è¡¨é¢æ¿
        self.file_panel = FileListPanel(self, self.file_handler)
        self.file_panel.grid(row=0, column=0, sticky='nsew', 
                           padx=(MD.SPACING_LG, MD.SPACING_SM), 
                           pady=MD.SPACING_LG)
        
        # æ§åˆ¶é¢æ¿
        self.control_panel = ControlPanel(self, self.file_handler)
        self.control_panel.grid(row=0, column=1, sticky='nsew',
                              padx=(MD.SPACING_SM, MD.SPACING_LG),
                              pady=MD.SPACING_LG)
        
        # è®¾ç½®å›è°ƒ
        self.file_panel.set_update_callback(self._on_file_update)
        self.control_panel.set_preview_callback(self._on_preview)
        self.control_panel.set_convert_callback(self._on_convert)
        
        # åˆ›å»ºé€šçŸ¥æ ‡ç­¾ï¼ˆåˆå§‹éšè—ï¼‰
        self.toast_label = None
    
    def _on_file_update(self, message: str, type: str = 'info'):
        """æ–‡ä»¶æ›´æ–°å›è°ƒ"""
        self.control_panel.update_stats()
        self._show_toast(message, type)
    
    def _on_preview(self, preview_type: str, data):
        """é¢„è§ˆå›è°ƒ"""
        if preview_type == 'template':
            TemplatePreviewDialog(self, data)
        
        elif preview_type == 'conversion':
            template = self.control_panel.get_template()
            max_files = self.settings.get('preview_max_files', 5)
            ConversionPreviewDialog(self, data, template, max_files)
        
        elif preview_type == 'warning':
            self._show_toast(f"âš ï¸ {data}", 'warning')
    
    def _on_convert(self, action: str, data):
        """è½¬æ¢å›è°ƒ"""
        if action == 'warning':
            self._show_toast(f"âš ï¸ {data}", 'warning')
            return
        
        if action == 'start':
            self._perform_conversion(data)
    
    def _perform_conversion(self, files):
        """æ‰§è¡Œè½¬æ¢"""
        # é€‰æ‹©ä¿å­˜ä½ç½®
        output_file = filedialog.asksaveasfilename(
            title="ä¿å­˜ Markdown æ–‡ä»¶",
            defaultextension=".md",
            filetypes=[("Markdown æ–‡ä»¶", "*.md"), ("æ‰€æœ‰æ–‡ä»¶", "*.*")]
        )
        
        if not output_file:
            return
        
        # æ˜¾ç¤ºè¿›åº¦
        self.control_panel.show_progress()
        
        # è®¾ç½®è½¬æ¢å™¨
        template = self.control_panel.get_template()
        self.converter.set_template(template)
        
        # è¿›åº¦å›è°ƒ
        def progress_callback(current, total, filename):
            self.control_panel.update_progress(current, total, filename)
            self.update_idletasks()
        
        # æ‰§è¡Œè½¬æ¢
        result = self.converter.convert_files(files, output_file, progress_callback)
        
        # éšè—è¿›åº¦
        self.after(1000, self.control_panel.hide_progress)
        
        # æ˜¾ç¤ºç»“æœ
        if result['success']:
            self._show_toast(f"âœ… {result['message']}", 'success')
            messagebox.showinfo(
                "è½¬æ¢å®Œæˆ",
                f"{result['message']}\n\nä¿å­˜ä½ç½®: {output_file}"
            )
        else:
            self._show_toast(f"âŒ {result['message']}", 'error')
            messagebox.showerror("è½¬æ¢å¤±è´¥", result['message'])
    
    def _show_toast(self, message: str, type: str = 'info'):
        """æ˜¾ç¤ºé€šçŸ¥æ¶ˆæ¯"""
        # é¢œè‰²æ˜ å°„
        colors = {
            'success': MD.SUCCESS,
            'error': MD.ERROR,
            'warning': MD.WARNING,
            'info': MD.INFO
        }
        
        color = colors.get(type, MD.INFO)
        
        # åˆ›å»ºé€šçŸ¥æ ‡ç­¾
        if self.toast_label:
            self.toast_label.destroy()
        
        self.toast_label = ctk.CTkLabel(
            self,
            text=message,
            font=MD.FONT_BODY,
            fg_color=color,
            text_color=MD.ON_PRIMARY,
            corner_radius=MD.RADIUS_MEDIUM,
            height=48
        )
        
        # å®šä½
        self.toast_label.place(relx=0.5, rely=0.92, anchor='center')
        
        # è‡ªåŠ¨æ¶ˆå¤±
        self.after(3000, lambda: self.toast_label.destroy() if self.toast_label else None)
    
    def _load_saved_state(self):
        """åŠ è½½ä¿å­˜çš„çŠ¶æ€"""
        # åŠ è½½æœ€è¿‘æ–‡ä»¶
        recent_files = self.settings.get('recent_files', [])
        for file_path in recent_files:
            if os.path.exists(file_path):
                self.file_handler.add_file(file_path)
        
        # åˆ·æ–°æ˜¾ç¤º
        self.file_panel.refresh()
        self.control_panel.update_stats()
    
    def _save_state(self):
        """ä¿å­˜çŠ¶æ€"""
        # ä¿å­˜çª—å£å¤§å°
        geometry = self.geometry().split('+')[0]  # åªå–å°ºå¯¸éƒ¨åˆ†
        width, height = map(int, geometry.split('x'))
        
        self.settings.set('window', {
            'width': width,
            'height': height,
            'min_width': 1000,
            'min_height': 600
        })
        
        # ä¿å­˜æ–‡ä»¶åˆ—è¡¨
        max_recent = self.settings.get('max_recent_files', 50)
        recent_files = [f.path for f in self.file_handler.files[:max_recent]]
        self.settings.set('recent_files', recent_files)
        
        # ä¿å­˜æ¨¡æ¿é€‰æ‹©
        self.settings.set('template', self.control_panel.get_template())
        
        # ä¿å­˜é…ç½®
        self.settings.save()
    
    def _on_closing(self):
        """å…³é—­çª—å£"""
        if self.settings.get('auto_save_config', True):
            self._save_state()
        
        self.destroy()
```

### 11. `utils/helpers.py` - è¾…åŠ©å‡½æ•°

```python
"""
è¾…åŠ©å·¥å…·å‡½æ•°
"""

import os
from typing import Optional

def get_relative_path(file_path: str, base_path: Optional[str] = None) -> str:
    """è·å–ç›¸å¯¹è·¯å¾„"""
    if base_path is None:
        base_path = os.getcwd()
    
    try:
        return os.path.relpath(file_path, base_path)
    except ValueError:
        return file_path

def truncate_string(s: str, max_length: int, suffix: str = '...') -> str:
    """æˆªæ–­å­—ç¬¦ä¸²"""
    if len(s) <= max_length:
        return s
    return s[:max_length - len(suffix)] + suffix

def validate_file_path(path: str) -> bool:
    """éªŒè¯æ–‡ä»¶è·¯å¾„"""
    return os.path.isfile(path) and os.path.exists(path)
```

### 12. `config/__init__.py` å’Œå…¶ä»– `__init__.py`

```python
# æ‰€æœ‰ __init__.py æ–‡ä»¶å†…å®¹
"""
Package initialization
"""
```

---

## ğŸ¨ Material Design 3 æ”¹è¿›ç‚¹

1. **é¢œè‰²ç³»ç»Ÿ**
   - é‡‡ç”¨ Material You é…è‰²æ–¹æ¡ˆ
   - Primaryã€Secondaryã€Tertiary ä¸‰çº§è‰²å½©
   - Surface é«˜ç¨‹ç³»ç»Ÿï¼ˆ5ä¸ªå±‚çº§ï¼‰

2. **ç»„ä»¶è®¾è®¡**
   - MaterialCard - æ”¯æŒä¸åŒé«˜ç¨‹
   - MaterialButton - 5ç§é£æ ¼ï¼ˆfilled, tonal, outlined, text, errorï¼‰
   - StatCard - ç²¾ç¾çš„ç»Ÿè®¡å¡ç‰‡
   - ç»Ÿä¸€çš„åœ†è§’å’Œé—´è·

3. **äº¤äº’ä½“éªŒ**
   - Toast é€šçŸ¥ç³»ç»Ÿ
   - æ¨¡æ€å¯¹è¯æ¡†
   - è¿›åº¦åé¦ˆ
   - æµç•…çš„çŠ¶æ€æ›´æ–°

4. **æ¨¡å—åŒ–æ¶æ„**
   - æ¸…æ™°çš„èŒè´£åˆ†ç¦»
   - æ˜“äºç»´æŠ¤å’Œæ‰©å±•
   - é…ç½®ä¸ä»£ç åˆ†ç¦»

## ğŸš€ ä½¿ç”¨æ–¹æ³•

```bash
# å®‰è£…ä¾èµ–
pip install customtkinter

# è¿è¡Œåº”ç”¨
python main.py
```

è¿™ä¸ªé‡æ„ç‰ˆæœ¬æ›´åŠ ç°ä»£ã€ä¸“ä¸šï¼Œç¬¦åˆ Material Design 3 è§„èŒƒï¼ğŸ‰